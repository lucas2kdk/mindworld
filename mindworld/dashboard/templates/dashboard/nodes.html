{% extends "base.html" %}

{% block title %}Kubernetes Nodes{% endblock %}

{% block content %}
<div class="flex-1 px-4 py-4">
    <h1 class="text-2xl font-semibold mb-4">Kubernetes Nodes</h1>
    <div id="nodes-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <!-- Nodes will be dynamically inserted here -->
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const nodesContainer = document.getElementById('nodes-container');
    const wsScheme = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
    const ws = new WebSocket(wsScheme + window.location.host + '/ws/nodes/');

    ws.onmessage = function(event) {
        const data = JSON.parse(event.data);
        nodesContainer.innerHTML = '';  // Clear existing nodes

        data.nodes.forEach(node => {
            const nodeDiv = document.createElement('div');
            nodeDiv.className = 'bg-white rounded-lg shadow p-4';
            nodeDiv.innerHTML = `
                <div class="space-y-2">
                    <h2 class="text-lg font-semibold">${node.name}</h2>
                    <p>Status: <span class="${node.status === 'Ready' ? 'text-green-500' : 'text-red-500'}">${node.status}</span></p>
                    <p>Pods: ${node.pods}</p>
                    <p>IP: ${node.ip}</p>
                    <p>OS: ${node.os}</p>
                </div>
            `;
            nodesContainer.appendChild(nodeDiv);
        });
    };

    ws.onclose = function(e) {
        console.log('WebSocket connection closed unexpectedly');
    };

    ws.onerror = function(error) {
        console.error('WebSocket error:', error);
    };
});
</script>
{% endblock %}

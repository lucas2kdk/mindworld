{% extends "base.html" %}

{% block title %}Kubernetes Nodes{% endblock %}

{% block content %}
<div class="flex-1 p-4">
    <h1 class="text-xl font-semibold mb-4">Kubernetes Nodes</h1>
    <div id="nodes-container" class="flex flex-wrap">
        <!-- Nodes will be dynamically inserted here -->
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const nodesContainer = document.getElementById('nodes-container');
        const ws = new WebSocket(`ws://${window.location.host}/ws/nodes/`);

        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            nodesContainer.innerHTML = '';  // Clear existing nodes

            data.nodes.forEach(node => {
                const nodeDiv = document.createElement('div');
                nodeDiv.className = 'w-full sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/4 p-4';
                nodeDiv.innerHTML = `
                    <div class="bg-white rounded-md p-4 shadow-md">
                        <h2 class="text-lg font-semibold mb-2">${node.name}</h2>
                        <p>Status: <span class="${node.status === 'Ready' ? 'text-green-600' : 'text-red-600'}">${node.status}</span></p>
                        <p>Pods: ${node.pods}</p>
                        <p>IP: ${node.ip}</p>
                        <p>OS: ${node.os}</p>
                        <div class="flex justify-end mt-4">
                            <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2">Drain</button>
                            <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded mr-2">Edit</button>
                        </div>
                    </div>
                `;
                nodesContainer.appendChild(nodeDiv);
            });
        };

        ws.onclose = function(e) {
            console.log('WebSocket connection closed unexpectedly');
            // Optionally try to reconnect or display a message
        };

        ws.onerror = function(error) {
            console.error('WebSocket error:', error);
            // Handle errors appropriately in your application
        };
    });
</script>
{% endblock %}

{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="flex-1 p-4">
    <h1 class="text-xl font-semibold mb-4">Minecraft Servers</h1>
    <div id="server-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <!-- Server cards will be dynamically inserted here -->
    </div>    
</div>

<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () {
        const wsScheme = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
        const webSocket = new WebSocket(wsScheme + window.location.host + '/ws/servers/');
    
        webSocket.onmessage = function(e) {
            console.log("Received data:", e.data);  // Log the received data for debugging
            const data = JSON.parse(e.data);
            if (data.type === 'server.status') {
                updateServerCards(data.data);
            }
        };
    
        function updateServerCards(servers) {
            const container = document.getElementById('server-container');
            container.innerHTML = '';  // Clear existing content
            servers.forEach(server => {
                const serverCard = document.createElement('div');
                serverCard.className = 'bg-white rounded-md p-4 shadow-md';
                serverCard.innerHTML = `
                    <h2 class="text-lg font-semibold mb-2">${server.name}</h2>
                    <p>Status: <span class="${server.status === 'Running' ? 'text-green-600' : 'text-red-600'}">${server.status}</span></p>
                    <p>Replicas: ${server.running_replicas}/${server.replicas}</p>
                    <div class="flex justify-end mt-4">
                        <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2">${server.status === 'Running' ? 'Stop' : 'Start'}</button>
                        <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">Edit</button>
                    </div>
                `;
                container.appendChild(serverCard);
            });
        }
    
        webSocket.onclose = function(e) {
            console.error('WebSocket closed unexpectedly');
        };
    });
</script>
    
    
{% endblock %}
